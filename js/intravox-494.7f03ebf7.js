"use strict";(self.webpackChunknextcloud_intravox=self.webpackChunknextcloud_intravox||[]).push([[494],{36746(e,t,a){a.d(t,{A:()=>o});var n=a(31601),i=a.n(n),s=a(76314),l=a.n(s)()(i());l.push([e.id,"\n.feed-settings[data-v-ccfe362c] {\n  padding: 0 16px 16px;\n}\n.feed-settings__description[data-v-ccfe362c] {\n  color: var(--color-text-maxcontrast);\n  margin-bottom: 16px;\n}\n.feed-settings__section[data-v-ccfe362c] {\n  margin-bottom: 16px;\n}\n.feed-settings__label[data-v-ccfe362c] {\n  font-weight: 600;\n  margin: 0 0 8px 0;\n  font-size: 14px;\n}\n.feed-settings__url-box[data-v-ccfe362c] {\n  display: flex;\n  gap: 8px;\n  align-items: center;\n}\n.feed-settings__url-input[data-v-ccfe362c] {\n  flex: 1;\n  padding: 8px 12px;\n  border: 1px solid var(--color-border);\n  border-radius: var(--border-radius);\n  background: var(--color-background-dark);\n  font-family: monospace;\n  font-size: 12px;\n  color: var(--color-text-maxcontrast);\n}\n.feed-settings__meta[data-v-ccfe362c] {\n  margin-top: 4px;\n  font-size: 12px;\n  color: var(--color-text-maxcontrast);\n}\n",""]);const o=l},93494(e,t,a){a.r(t),a.d(t,{default:()=>V});var n=a(20641),i=a(90033);const s={class:"feed-settings"},l={class:"feed-settings__description"},o={class:"feed-settings__section"},d={class:"feed-settings__label"},c={class:"feed-settings__section"},r={class:"feed-settings__label"},g={key:0,class:"feed-settings__section"},f={class:"feed-settings__label"},p={class:"feed-settings__url-box"},u=["value"],v={key:0,class:"feed-settings__meta"};var h=a(66802),k=a(63814),y=a(53334),_=a(85168),m=a(76333),b=a(78276);const C={name:"FeedSettings",components:{NcDialog:m.i$,NcButton:m.x1,NcSelect:m.EQ,NcCheckboxRadioSwitch:m.AO,NcNoteCard:m.mQ,ContentCopy:b.A},emits:["close"],data:()=>({loading:!0,generating:!1,saving:!1,linkSharingDisabled:!1,feedUrl:null,lastAccessed:null,localConfig:{scope:"language",limit:20},limitOptions:[10,20,30,50]}),async created(){await this.loadToken()},methods:{t:(e,t={})=>(0,y.Tl)("intravox",e,t),async loadToken(){this.loading=!0;try{const e=(0,k.Jv)("/apps/intravox/api/feed/token"),t=(await h.Ay.get(e)).data;if(t.linkSharingDisabled)return void(this.linkSharingDisabled=!0);t.hasToken&&(this.feedUrl=t.feedUrl,this.lastAccessed=t.last_accessed?new Date(t.last_accessed).toLocaleString():null,t.config&&(this.localConfig={scope:"all"===t.config.scope?"all":"language",limit:t.config.limit||20}))}catch(e){(0,_.Qg)(this.t("Failed to load feed settings"))}finally{this.loading=!1}},async generateToken(){this.generating=!0;try{const e=(0,k.Jv)("/apps/intravox/api/feed/token"),t=(await h.Ay.post(e,{scope:this.localConfig.scope,limit:this.localConfig.limit})).data;t.hasToken&&(this.feedUrl=t.feedUrl,(0,_.Te)(this.t("Feed URL generated")))}catch(e){(0,_.Qg)(this.t("Failed to generate feed URL"))}finally{this.generating=!1}},async regenerateToken(){this.generating=!0;try{const e=(0,k.Jv)("/apps/intravox/api/feed/token"),t=(await h.Ay.post(e,{scope:this.localConfig.scope,limit:this.localConfig.limit})).data;t.hasToken&&(this.feedUrl=t.feedUrl,(0,_.Te)(this.t("Feed URL regenerated. The old URL no longer works.")))}catch(e){(0,_.Qg)(this.t("Failed to regenerate feed URL"))}finally{this.generating=!1}},async revokeToken(){try{const e=(0,k.Jv)("/apps/intravox/api/feed/token");await h.Ay.delete(e),this.feedUrl=null,this.lastAccessed=null,(0,_.Te)(this.t("Feed URL revoked"))}catch(e){(0,_.Qg)(this.t("Failed to revoke feed URL"))}},async saveConfig(){this.saving=!0;try{const e=(0,k.Jv)("/apps/intravox/api/feed/config"),t=await h.Ay.put(e,{scope:this.localConfig.scope,limit:this.localConfig.limit});t.data.feedUrl&&(this.feedUrl=t.data.feedUrl),(0,_.Te)(this.t("Feed settings saved"))}catch(e){(0,_.Qg)(this.t("Failed to save feed settings"))}finally{this.saving=!1}},async copyFeedUrl(){try{await navigator.clipboard.writeText(this.feedUrl),(0,_.Te)(this.t("Feed URL copied to clipboard"))}catch(e){this.$refs.urlInput?.select(),(0,_.Qg)(this.t("Could not copy automatically. Please copy the selected URL."))}}}};var x=a(85072),U=a.n(x),L=a(97825),F=a.n(L),S=a(77659),T=a.n(S),A=a(55056),R=a.n(A),w=a(10540),Q=a.n(w),W=a(41113),N=a.n(W),X=a(36746),D={};D.styleTagTransform=N(),D.setAttributes=R(),D.insert=T().bind(null,"head"),D.domAPI=F(),D.insertStyleElement=Q(),U()(X.A,D),X.A&&X.A.locals&&X.A.locals;const V=(0,a(66262).A)(C,[["render",function(e,t,a,h,k,y){const _=(0,n.g2)("NcNoteCard"),m=(0,n.g2)("NcCheckboxRadioSwitch"),b=(0,n.g2)("NcSelect"),C=(0,n.g2)("ContentCopy"),x=(0,n.g2)("NcButton"),U=(0,n.g2)("NcDialog");return(0,n.uX)(),(0,n.Wv)(U,{open:!0,name:y.t("RSS Feed"),size:"normal",onClose:t[4]||(t[4]=t=>e.$emit("close"))},(0,n.eX)({default:(0,n.k6)(()=>[(0,n.Lk)("div",s,[(0,n.Q3)(" Admin disabled link sharing "),k.linkSharingDisabled?((0,n.uX)(),(0,n.Wv)(_,{key:0,type:"error"},{default:(0,n.k6)(()=>[(0,n.eW)((0,i.v_)(y.t("RSS feeds are disabled. The administrator has turned off public link sharing in the Nextcloud Sharing settings.")),1)]),_:1})):(0,n.Q3)("v-if",!0),k.linkSharingDisabled?(0,n.Q3)("v-if",!0):((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.Lk)("p",l,(0,i.v_)(y.t("Generate a personal RSS feed URL to follow IntraVox updates in your favorite RSS reader. The feed only shows pages you have access to.")),1),(0,n.Q3)(" Scope selection "),(0,n.Lk)("div",o,[(0,n.Lk)("h4",d,(0,i.v_)(y.t("Feed scope")),1),(0,n.bF)(m,{modelValue:k.localConfig.scope,"onUpdate:modelValue":t[0]||(t[0]=e=>k.localConfig.scope=e),value:"language",name:"feed-scope",type:"radio"},{default:(0,n.k6)(()=>[(0,n.eW)((0,i.v_)(y.t("My language")),1)]),_:1},8,["modelValue"]),(0,n.bF)(m,{modelValue:k.localConfig.scope,"onUpdate:modelValue":t[1]||(t[1]=e=>k.localConfig.scope=e),value:"all",name:"feed-scope",type:"radio"},{default:(0,n.k6)(()=>[(0,n.eW)((0,i.v_)(y.t("All languages")),1)]),_:1},8,["modelValue"])]),(0,n.Q3)(" Limit "),(0,n.Lk)("div",c,[(0,n.Lk)("h4",r,(0,i.v_)(y.t("Maximum items")),1),(0,n.bF)(b,{modelValue:k.localConfig.limit,"onUpdate:modelValue":t[2]||(t[2]=e=>k.localConfig.limit=e),options:k.limitOptions,clearable:!1,reduce:e=>e},null,8,["modelValue","options","reduce"])]),(0,n.Q3)(" Feed URL (shown after token is generated) "),k.feedUrl?((0,n.uX)(),(0,n.CE)("div",g,[(0,n.Lk)("h4",f,(0,i.v_)(y.t("Your feed URL")),1),(0,n.Lk)("div",p,[(0,n.Lk)("input",{ref:"urlInput",value:k.feedUrl,class:"feed-settings__url-input",readonly:"",onFocus:t[3]||(t[3]=t=>e.$refs.urlInput.select())},null,40,u),(0,n.bF)(x,{type:"secondary","aria-label":y.t("Copy URL"),onClick:y.copyFeedUrl},{icon:(0,n.k6)(()=>[(0,n.bF)(C,{size:20})]),_:1},8,["aria-label","onClick"])]),k.lastAccessed?((0,n.uX)(),(0,n.CE)("p",v,(0,i.v_)(y.t("Last accessed: {date}",{date:k.lastAccessed})),1)):(0,n.Q3)("v-if",!0)])):(0,n.Q3)("v-if",!0),(0,n.Q3)(" Warning about token secrecy "),k.feedUrl?((0,n.uX)(),(0,n.Wv)(_,{key:1,type:"warning"},{default:(0,n.k6)(()=>[(0,n.eW)((0,i.v_)(y.t("This URL contains a personal token. Anyone with this link can read your feed. Do not share it publicly.")),1)]),_:1})):(0,n.Q3)("v-if",!0)],64))])]),_:2},[k.linkSharingDisabled?void 0:{name:"actions",fn:(0,n.k6)(()=>[k.feedUrl?((0,n.uX)(),(0,n.Wv)(x,{key:0,type:"error",onClick:y.revokeToken},{default:(0,n.k6)(()=>[(0,n.eW)((0,i.v_)(y.t("Revoke")),1)]),_:1},8,["onClick"])):(0,n.Q3)("v-if",!0),k.feedUrl?((0,n.uX)(),(0,n.Wv)(x,{key:1,type:"secondary",onClick:y.regenerateToken},{default:(0,n.k6)(()=>[(0,n.eW)((0,i.v_)(y.t("Regenerate")),1)]),_:1},8,["onClick"])):(0,n.Q3)("v-if",!0),k.feedUrl?((0,n.uX)(),(0,n.Wv)(x,{key:3,type:"primary",disabled:k.saving,onClick:y.saveConfig},{default:(0,n.k6)(()=>[(0,n.eW)((0,i.v_)(y.t("Save settings")),1)]),_:1},8,["disabled","onClick"])):((0,n.uX)(),(0,n.Wv)(x,{key:2,type:"primary",disabled:k.generating,onClick:y.generateToken},{default:(0,n.k6)(()=>[(0,n.eW)((0,i.v_)(y.t("Generate Feed URL")),1)]),_:1},8,["disabled","onClick"]))]),key:"0"}]),1032,["name"])}],["__scopeId","data-v-ccfe362c"]])}}]);